# 为什么MySQL默认隔离级别为RR

## 遗留bug

- MySQL5.0之前主从同步binlog只支持statement格式
- RC级别下，不同事务的操作相互影响，导致binlog同步造成大量脏数据

| A            | B            | binlog   |
| ------------ | ------------ | -------- |
| 开始事务     |              |          |
| 删除指定数据 | 开始事务     |          |
|              | 新增指定数据 |          |
|              | 提交         | 新增数据 |
| 提交         |              | 删除数据 |

> 因为基于statement的binlog，在RC条件下会乱序，使得数据不准确。

## 解决办法

- 使用RR隔离级别：间隙锁，delete时候会阻止数据插入，隔离指令作用
- 使用RC+ROW(5.1)：针对数据而非针对SQL进行同步

## 为什么高并发常用RC

- RR引入间隙锁，提升死锁可能性
- RR未命中锁表，RC不命中锁行
- RC引入半一致性读增加更新操作性能
- RC+ROW可以避免binlog同步错误
- RC的可重复读可以接收，毕竟都已经提交

# 为什么MySQL默认引擎采用innodb

|                | Innodb                                         | MyIsam                             |
| -------------- | ---------------------------------------------- | ---------------------------------- |
| 事务           | 支持                                           | 不支持                             |
| 外键           | 支持                                           | 不支持                             |
| 索引和数据绑定 | 绑定，只需查询一次                             | 不绑定，分开存储<br />查询需要两次 |
| 行数量         | 不绑定，``select(*)``扫描全表                  | 支持，直接读取                     |
| 锁             | 行级别、表级别                                 | 只支持表级别锁                     |
| 其他           | 插入缓冲<br />二次写<br />自适应hash<br />预读 |                                    |
|                |                                                |                                    |

