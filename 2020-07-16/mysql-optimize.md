# SQL语句优化

## 1. 避免使用子查询

- 子查询结果使用临时表，消耗内存
- 旧版本(5.5)优先执行外部查询，再进行子语句条件匹配，外层数据量过大查询速度慢
- 新版本(5.6)使用``join``进行了优化，但仅针对``select``，对于``update/delete``无效

## 2. 避免使用函数索引

- ``MySQL``不支持函数索引，函数作用于函数，会导致索引失效，从而进行全表扫描

## 3. BETWEEN > IN > OR

- 使用``OR``会逐条匹配，使用``IN``会进行排序，从而提高查询效率
- 如果数据连续，推荐使用``BETWEEN``顺序读取，而不是``IN``的逐个匹配

## 4. 模糊搜索索引失效

- 模糊搜索应当针对索引列，避免使用全文索引
- 前缀``%``、``*``会导致索引失效，尽量使用明确前缀+后缀``%``，或者更精确的查询条件

## 5. 范围查询

- 数据量较大，查询慢、传输效率低，应该设置``limit``数据限制
- 避免使用分页查询，这会导致``MySQL``进行无用的扫描，推荐``select XXX from table where id > 1 limit 20``

> 先定点数据然后顺序扫描，能够有效提高查询效率。

## 6. 禁止排序

- ``group by``会默认进行排序，无需求的话可以通过``order by null``禁止排序
- 排序字段如果没有索引，应当添加索引或者剔除排序

## 7. 优先批量插入

- 批量插入，多方面复用，提高性能

## 8. 避免负向查询

- 正向查询直接通过索引可以缩小查询数据范围，负向查询将范围搜索变成单条件检测，需要进行全部数据集匹配

## 9. 避免``select *``

- 冗余数据，增加``cpu``、``io``、内存、带宽等资源消耗
- 减少覆盖索引的使用场景

# MySQL索引优化

## JOIN优化

- ``join``需要使用内存，应保证足够的``join buffer size``
- 使用更快的固态硬盘
- 尽量使用小表去驱动大表
- 条件列应当加上索引，提高匹配速度

## 避免索引失效

- 注意联合索引左前匹配
- 不在非索引列进行操作
- 范围条件放最后，``MySQL``不能使用索引中范围条件右边的列
- 尽量使用覆盖索引
- 不要使用反向条件，``!=``、``<>``，这会导致全表扫描
- 不要使用``null``，``is null``、``is not null``会导致全表扫描
- 模糊匹配以``%``开头导致索引失效
- 字符串不加单引号索引失效
- 使用``or``进行条件连接，导致索引失效
- 不要再索引的左边进行计算``where num / 2 = 100``，应该``where num = 2 * 100``。



