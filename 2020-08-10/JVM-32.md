# 为什么推荐JVM内存不超过32G

## 内存地址

**内存分段寻址**中，使用偏移量进行表示，可以通过短字段的组合来对更多的空间进行索引。

对比``32``和``64``位的操作系统，对于低地址的内存索引，有一半的地址空间是被浪费的。

并且，由于地址的长度变大，会占用``CPU``自身计算带宽，降低``CPU``的处理性能。

## 对象压缩指针

``JVM``中，在堆空间的对象都会采用指针进行引用记录。

在32G以下，会采用内存指针压缩进行记录，这个时候同**内存分段寻址**一样，采用偏移量的方式进行记录。

> 对于32bit的地址，可以记录的数量为40亿个对象，即内存占用达到32G，依然可以使用32bit的地址进行对象记录。

但是，如果内存设置在32G以上，换言之，你的期望对象数量可能会超过40亿，这个时候就会使用全指针进行记录，而非压缩指针。

> 由于全指针会造成浪费，对象占用达到40~50G时，相当于压缩指针下的32G有效内存。

因此，生产实践中不建议将堆内存设置超过32G。

## 超过32G弊端

- 造成内存空间浪费
- 降低CPU性能
- 主存和L1等缓存同步时会占用更多的带宽
  - 尤其伪共享情况下，会造成更多的阻塞问题

