# HTTP

## 报文格式

```properties
{METHOD} {URI} {VERSION}
{KEY1}:{VALUE1}
{KEY1}:{VALUE1}

{BODY}
```

| field       | description |
| ----------- | ----------- |
| ``METHOD``  | 提交方式    |
| ``URI``     | 访问地址    |
| ``VERSION`` | 协议版本    |
| ``BODY``    | 请求体      |

### METHOD

| method      | description                                            |
| ----------- | ------------------------------------------------------ |
| ``GET``     | 请求资源，返回主体                                     |
| ``HEAD``    | 请求资源，获取报头                                     |
| ``POST``    | 提交数据进行请求，可能导致资源变更                     |
| ``PUT``     | 修改指定资源内容                                       |
| ``DELETE``  | 资源删除请求                                           |
| ``CONNECT`` | HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器 |
| ``OPTIONS`` | 允许客户端查看服务器性能                               |
| ``TRACE``   | 回显请求，用于测试或诊断                               |

### GET和POST

|          | GET                   | POST                                                |
| -------- | --------------------- | --------------------------------------------------- |
| method   | ``GET``               | ``POST``                                            |
| 数据传输 | ``URL``               | ``URL``<br />``BODY``                               |
| 数据加密 | 明文传输              | 加密传输                                            |
| 数据传输 | ``head+data``一次传输 | ``head``请求，返回100，再传输``data``<br />两次传输 |
| 数据长度 | ``URL``长度受限       | 服务器设置                                          |
| 幂等     | 幂等                  | 不幂等                                              |
| 结果缓存 | 有缓存                | 无缓存，每次重新请求                                |
| 数据格式 | ``ASCII``             | 无限制                                              |

# HTTPS验证

## CA签证

- 基础信息
  - 公钥
  - 域名
  - 签名
  - 其他信息
    - 身份信息
    - 证书使用场景
    - ...
- CA签证
  - 身份核实：申请人是证书中的申请人，防止冒充申请
  - 证书签证
    - 申请者信息
    - CA基本信息
    - 证书使用年限
    - 申请人公钥
    - 签名摘要算法
    - CA签名

## HTTPS握手

| order | client                                                       | server                                           |
| ----- | ------------------------------------------------------------ | ------------------------------------------------ |
| 1     | 发起``https``连接请求                                        |                                                  |
| 2     |                                                              | 回复网站的``CA``证书                             |
| 3     | 从信任库中查找对应的``CA``证书，并使用``CA``公钥解密网站证书 |                                                  |
| 4     | 核对校验码：根据摘要算法重新计算证书校验码，对比证书校验码   |                                                  |
| 5     | 核对域名：取出证书``CN``，核对的请求域名                     |                                                  |
| 6     | 核对完成，生成新的密钥对，使用网站公钥将新密钥公钥加密，发送给服务端 | 服务端接收，用网站私钥解密，得到新生成密钥对公钥 |
| 7     | 使用新密钥对私钥加密、解密进行数据传输                       | 使用新密钥对私钥加密、解密进行数据传输           |

# HTTP1.0/1.1/2.0

## HTTP1.0/1.1

|          | 1.0                                      | 1.1                                                          |
| -------- | ---------------------------------------- | ------------------------------------------------------------ |
| 使用时间 | 1996                                     | 1999                                                         |
| 缓存处理 | Expires<br />If-Modified-Since           | Expires<br />If-Match<br />Entity tag<br />If-None-Match<br />If-Modified-Since<br />If-Unmodified-Since |
| 对象传输 | 部分请求，整体对象传输                   | 支持``range``，返回码206                                     |
| 错误码   |                                          | 新增29个错误码                                               |
| HOST头   | 无``hostname``<br />认为但服务器单``IP`` | 有``hostname``<br />但服务器多虚拟机<br />无``hostname``400(bad request) |
| 连接方式 | 一次请求一次连接                         | 默认``Connection: leep-alive``<br />单个``TCP``连接传输多个``HTTP``请求响应 |

## SPDY

![image-20210520134702751](../.imgs/spdy)

| 改进           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 多路复用       | 对于一个域名，持有``TCP``连接有限，请求间保证顺序，会相互阻塞<br />多路复用解决了相互阻塞问题，提高带宽利用率，降低传输延时 |
| 请求优先级     | 防止多路复用平等对待，优先资源迟迟不能加载，可以指定优先级   |
| ``header``压缩 | 部分``header``重复多余，压缩后减少网络包大小和数量，提高传输效率 |
| 服务端推送     | 返回数据的时候可以多传输一些必要数据，后续请求直接查询缓存   |

## HTTP2.0和SPDY

|          | HTTP2.0                                                     | SPDY                                            |
| -------- | ----------------------------------------------------------- | ----------------------------------------------- |
| 设计     | 基于``SPDY``                                                |                                                 |
| 加密     | 支持明文、加密                                              | 强制``HTTPS``                                   |
| 压缩算法 | [HPACK](http://http2.github.io/http2-spec/compression.html) | [DEFLATE](http://zh.wikipedia.org/wiki/DEFLATE) |

## HTTP1.1/2.0

|                | HTTP1.1                       | HTTP2.0                                                      |
| -------------- | ----------------------------- | ------------------------------------------------------------ |
| 二进制格式     | 字符编码``ASCII``             | 纯二进制                                                     |
| 连接复用       | 共用``TCP``连接，但是顺序阻塞 | 多路复用<br />分拣``req_id``<br />并发访问                   |
| ``header``压缩 | 重复头报文传输                | 1. 压缩传输，减少传输数据<br />2. 缓存``head fields``，避免传输 |
| 服务端推送     | 支持                          | 支持                                                         |

