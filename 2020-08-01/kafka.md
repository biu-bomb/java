# Kafka-可靠性

## 数据确认

``acks``

- 0：不等待确认消息
- ``n``：等待``n``个ISR复制节点确认消息再确认接收消息
- ``-1``：全体复制节点确认后再确认接收消息

## 分区副本

``replication-factor``指定副本数，多份复制防止数据丢失。

## leader选举

当``leader``宕机，会在``ISR``的``follower``中选举新的``learder``。

# Kafka-一致性

- ``LEO(Log end Offset)``：同步数据以后，更新为下一条消息的位移值
- ``HW(High watermark)``：对于同一个副本，``HW``不会高于``LEO``
- 同步：数据复制时，``HW = min(source(HW), LEO)``
- 消费：只允许消费``HW``以下的消息

由此可见，在``HW``以下的数据，必定是全部复制集的确认数据，该部分数据在每个节点都已经复制完成。



