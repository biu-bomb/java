# 三次握手

![img](../.imgs/shake3)

| order | client                                                | server                                                       |
| ----- | ----------------------------------------------------- | ------------------------------------------------------------ |
| 1     | SYN=1,seq=x<br />发送，进入``SYN-SENT``状态           |                                                              |
| 2     |                                                       | SYN=1,ACK=1,seq=y,ack=x+1<br />发送，进入``SYN-RCVD``住在哪个太 |
| 3     | ACK=1,seq=x+1,ack=y+1<br />回复，进入``ESTAB-LISHED`` | 接收，进入``ESTAB-LISHED``状态                               |

## 为什么要三次握手

1. 数据编号

   因为``TCP``双工，针对一端的数据编号确认，至少需要一次``req-resp``。

   因此不可能在低于两次完成双端的数据序号的确认。

   在``resp1-req2``的场景下，响应+请求，直接二合一操作，减少传输次数。

2. 重复连接

   如果数据报文连接分开维护，不仅是需要$2 \times 2$次的传输交互，还会引发更多问题。

   - 服务端何时连接
     - 服务端不知道何时开始进行服务端的序号确认
   - 客户端重连接
     - 如果客户端重新连接，原有的客户端连接直接被放弃，服务端的连接得不到维护，数据不安全